# Squash Ladder

A web application for managing a squash ladder where players can view rankings and log matches.

## Architecture

- **Backend**: gRPC server (Go) with gRPC-Web support - serves player ranking APIs via Protocol Buffers
- **Frontend**: React TypeScript application - displays player rankings using gRPC-Web client
- **Build System**: Bazel for unified builds with automatic proto code generation using `rules_proto_grpc`

## Prerequisites

- Go 1.23 or later
- Node.js 20.x or later
- Bazel 6.0 or later
- Docker Desktop with Kubernetes enabled (Settings > Kubernetes > Enable Kubernetes)
- Protocol Buffers: Proto code generation is handled automatically by Bazel

## Development Workflows

We support two distinct workflows:

### 1. Local Iterative Development (Recommended)

Fast feedback loop using a local Go process and Vite dev server.

```bash
./scripts/dev_local.sh
```

This script:
1. Generates proto files (`scripts/gen_protos.sh`).
2. Starts the Go server via Bazel (`bazel run //server:server`).
3. Starts the Vite client (`npm run dev`).
4. Cleans up processes on exit (Ctrl+C).

### 2. Kubernetes Deployment

Production-like environment using Docker and Kubernetes.

```bash
./scripts/deploy_k8s.sh
```

This script:
1. Generates proto files.
2. Builds Docker images for Server and Client.
3. Deploys to the configured Kubernetes cluster.

## Manual Setup

If you prefer to set up manually:

### 1. Build Docker Images

```bash
# Build Server
docker buildx build -t squash-ladder-server:latest -f server/Dockerfile .

# Build Client
# Note: You must generate proto files first (run ./scripts/gen_protos.sh) if not present
docker buildx build -t squash-ladder-client:latest -f client/Dockerfile client/
```

### 2. Deploy to Kubernetes

```bash
kubectl apply -f k8s/
```

## Running the Application

Once deployed, the application will be available at:

- **Client**: `http://localhost` (or your cluster IP)
- **Server**: Accessed internally by the client via the Nginx proxy

### Verifying Deployment

```bash
kubectl get pods
kubectl get services
```


## API Endpoints

### gRPC-Web Service

- **Service**: `players.PlayersService`
- **Method**: `ListPlayers(ListPlayersRequest) returns (ListPlayersResponse)`
  - Returns a list of all players ordered by rank
  - Uses gRPC-Web protocol for browser compatibility
  - Service path: `/players.PlayersService/ListPlayers`

### REST Fallback (JSON)

- `GET /api/players` - Returns a JSON list of all players ordered by rank
  - Provided for compatibility, but the client uses gRPC-Web by default

## Project Structure

```
squash-ladder/
├── MODULE.bazel           # Bazel module configuration (Bazel 6+ uses Bzlmod)
├── BUILD                  # Root BUILD file
├── server/                # gRPC server
│   ├── proto/            # Protocol Buffer definitions
│   ├── handlers/         # gRPC service handlers
│   ├── cmd/server/       # Server entry point
│   └── BUILD             # Bazel build rules (proto code generated automatically)
├── client/               # React TypeScript frontend
│   ├── src/              # React source code
│   │   └── grpc/         # gRPC-Web client code (proto code generated by Bazel)
│   ├── public/           # Static assets
│   └── BUILD             # Bazel build rules (uses rules_proto_grpc)
└── scripts/              # Utility scripts
```

## Next Steps

- [ ] Add Firebase authentication
- [ ] Replace mock data with database (PostgreSQL/SQLite)
- [ ] Add match logging functionality
- [ ] Implement ladder movement logic
