# Squash Ladder

A web application for managing a squash ladder where players can view rankings and log matches.

## Architecture

- **Backend**: gRPC server (Go) with gRPC-Web support - serves player ranking APIs via Protocol Buffers
- **Frontend**: React TypeScript application - displays player rankings using gRPC-Web client
- **Build System**: Bazel for unified builds with automatic proto code generation using `rules_proto_grpc`

## Prerequisites

- Go 1.23 or later
- Node.js 20.x or later
- Bazel 6.0 or later
- Protocol Buffers: Proto code generation is handled automatically by Bazel

## Quick Setup

Run the automated setup script to handle everything:

```bash
./scripts/setup.sh
```

This script will:
1. Check prerequisites (Go, Node.js, npm, Bazel)
2. Install Go dependencies
3. Install Node.js dependencies
4. Generate proto TypeScript/JavaScript files for the client
5. Build server with Bazel (proto code is generated automatically)
6. Optionally start both server and client

## Manual Setup

If you prefer to set up manually:

### 1. Install Dependencies

#### Backend (Go)
```bash
cd server
go mod download
```

#### Frontend (Node.js)
```bash
cd client
npm install
```

### 2. Generate Proto Files for Client

Generate TypeScript and gRPC-Web code from proto files for the client using Bazel:

```bash
bazel build //client/src/grpc:players_proto_ts //client/src/grpc:players_grpc_web
```

This generates:
- TypeScript message types and definitions (via `ts_proto_library`)
- gRPC-Web service client stubs (via `js_grpc_web_library`)

The code generation is handled by `rules_proto_grpc`, which provides industry-standard Bazel rules for proto compilation. The setup script handles this automatically.

### 3. Build with Bazel

Protocol Buffer code for the server is automatically generated by Bazel during the build process.

Build the server:
```bash
bazel build //server:server
```

Build the client:
```bash
bazel build //client:client_package
```

## Running the Application

### Development Mode

#### Start the Server

Using Go directly:
```bash
cd server
go run cmd/server/main.go
```

Or using Bazel:
```bash
bazel run //server:server
```

The server will start on `http://localhost:8080` and serves:
- gRPC-Web endpoints for the PlayersService
- JSON REST fallback at `/api/players` for client compatibility

#### Start the Client

```bash
cd client
npm run dev
```

The client will start on `http://localhost:3000`

### Production Build

Build both server and client:
```bash
bazel build //server:server //client:client_package
```

## API Endpoints

### gRPC-Web Service

- **Service**: `players.PlayersService`
- **Method**: `ListPlayers(ListPlayersRequest) returns (ListPlayersResponse)`
  - Returns a list of all players ordered by rank
  - Uses gRPC-Web protocol for browser compatibility
  - Service path: `/players.PlayersService/ListPlayers`

### REST Fallback (JSON)

- `GET /api/players` - Returns a JSON list of all players ordered by rank
  - Provided for compatibility, but the client uses gRPC-Web by default

## Project Structure

```
squash-ladder/
├── MODULE.bazel           # Bazel module configuration (Bazel 6+ uses Bzlmod)
├── BUILD                  # Root BUILD file
├── server/                # gRPC server
│   ├── proto/            # Protocol Buffer definitions
│   ├── handlers/         # gRPC service handlers
│   ├── cmd/server/       # Server entry point
│   └── BUILD             # Bazel build rules (proto code generated automatically)
├── client/               # React TypeScript frontend
│   ├── src/              # React source code
│   │   └── grpc/         # gRPC-Web client code (proto code generated by Bazel)
│   ├── public/           # Static assets
│   └── BUILD             # Bazel build rules (uses rules_proto_grpc)
└── scripts/              # Utility scripts
```

## Next Steps

- [ ] Add Firebase authentication
- [ ] Replace mock data with database (PostgreSQL/SQLite)
- [ ] Add match logging functionality
- [ ] Implement ladder movement logic
