server {
    listen 80;
    server_name localhost;

    root /usr/share/nginx/html;
    index index.html;

    location / {
        try_files $uri $uri/ /index.html;
    }

    # Proxy API requests to the server service
    # The trailing slash is important to strip /players prefix if the server expects root
    # But based on the proto, the grpc-web requests usually go to /Package.Service/Method
    # The previous vite config proxied /players, implying the server might handle /players or it's just a prefix match.
    # Looking at players.go, usually gRPC-Web is handled at root or with specific prefix.
    # If the user was proxying /players -> http://localhost:8080, and the server is standard gRPC-Web wrap, 
    # it likely listens on root.
    # However, let's verify what the client actually requests.
    # Assuming standard gRPC-Web, the path is /squashladder.PlayersService/GetPlayers (example).
    # Wait, the vite config said:
    # proxy: { '/players': { target: 'http://localhost:8080', changeOrigin: true } }
    # This implies the client makes requests starting with /players.
    # Let's assume we need to proxy everything that isn't a static file, OR specific paths.
    # But for safety and generic gRPC-web support, usually we proxy the specific service prefixes.
    # Since I don't know the exact paths without digging deeper into the proto generated code,
    # I will inspect the vite config again. 
    # It specifically proxies '/players'. This suggests the URL path starts with /players.
    
    location /players/ {
        # Strip the /players/ prefix before forwarding to the server
        rewrite ^/players/(.*) /$1 break;
        proxy_pass http://server-service:8080;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
}
